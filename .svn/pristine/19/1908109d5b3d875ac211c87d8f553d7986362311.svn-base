function get_url_hash(e){for(var t={},a=location.href,n=a.split("?")[1],i=n.split("&"),o=0;o<i.length;o++){var r=i[o].split("=")[0],s=i[o].split("=")[1];t[r]=s}return t[e]}function setRefreshHeight(){var e=window.screen.height;$(".aui-refresh-content").css("min-height",e-50+"px")}function getTaskParams(e){var t=mergeInfo("task_global_params","");ajaxFun(t,e,"")}function getAnswerType(e){var t=mergeInfo("consult_global_params","");ajaxFun(t,e,"")}function getRandStr(e){for(var t="",a=0;a<e;a++)t+=Math.floor(10*Math.random()).toString();return t}function getCurTime(){var e=new Date,t=e.getFullYear().toString().substr(2),a=e.getMonth()+1<10?"0"+(e.getMonth()+1):(e.getMonth()+1).toString(),n=e.getDate()<10?"0"+e.getDate():e.getDate().toString(),i=e.getHours()%12<10?"0"+e.getHours()%12:(e.getHours()%12).toString(),o=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes().toString(),r=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds().toString();return t+a+n+i+o+r}function wxChooseImage(){wx.chooseImage({count:1,needResult:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){localIds=e.localIds[0].toString(),rh.tostr(localIds)&&wxuploadImage(localIds)},fail:function(e){alterShowMessage("操作提示",JSON.stringify(e),"1","确定","","","")}})}function wxBasicInfo(e){timestamp=Date.parse(new Date).toString(),nonceStr="123456";var t={nonce_str:nonceStr,timestamp:timestamp,url:location.href},a=mergeInfo("get_wechat_signature",t);ajaxFun(a,e,"")}function md5_pwd(e){var t="WKhioMgQ7OhErmvIuM",a="###"+md5(md5(t+e));return a}function ajaxFun(e,t,a){$.ajax({type:"POST",url:apiUrl,data:e,dataType:"html",contentType:"application/json; charset=utf-8",beforeSend:a,success:t,error:errorFun})}function beforeLoadFun(e){var t=createLoadDom();e.append(t)}function beforeDialogFun(){var e=createDialog();$("body").append(e)}function errorFun(){$(".zhezhao, .loading-more").remove()}function createLoadDom(){var e=$("<div />").addClass("load-wrapper loading-more"),t=$("<img />").attr("src",localStorage.localStorage_url+"loading.gif"),a=$("<span />").text("加载中");return e.append(t,a),e}function createDialog(){var e=$("<div />").addClass("zhezhao"),t=$("<img />").attr("src",localStorage.localStorage_url+"loading.gif");return e.append(t),e}function createEmptyDom(){var e=$("<div />").addClass("empty"),t=$("<span />").text("无更多数据");return e.append(t),e}function mergeInfo(e,t){var a=wechat,n=getRandStr(5),i=getCurTime(),o=hex_sha1(hex_sha1(i+n)+a),r={header:{timestamp:i,nonce:n,signature:o},cmd:{name:e},data:t};r=JSON.stringify(r),r=Base64.encode(r);var s=[];return s.push(r),s.push(a),s=Base64.encode(JSON.stringify(s))}function decodeMsg(e){return e=JSON.parse(Base64.decode(JSON.parse(Base64.decode(e))[0]))}var apiUrl="http://xxgc.manyouku.com/api.php",wechat=100,appid="wxd1d0f0098446708c",timestamp,nonceStr,stageList={},typeList={},account_type={},page=1,pagesize=10,Login=function(e){var t=new auiToast,a={init:function(){window.localStorage.setItem("localStorage_url",e(".localStorage-url").val()),a.checkUserInfo()},checkUserInfo:function(){e(".login-btn").bind("click",function(n){n.stopPropagation();var i=e(".username").val(),o=e(".userpwd").val();if(!i)return t.fail({title:"请输入用户名",duration:5e3}),e(".username").focus(),!1;if(!o)return t.fail({title:"请输入密码",duration:5e3}),e(".userpwd").focus(),!1;o=md5_pwd(o);var r={user_name:i,user_pwd:o},s=mergeInfo("a_login",r);ajaxFun(s,a.successFun,beforeDialogFun)})},successFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t);if(1==a.errcode){var n=a.data.user_id;window.localStorage.setItem("user_id",n),window.location.href=taskUrl}else alert(a.errmsg)}};return{init:a.init}}(jQuery),TaskList=function(e){var t,a,n=4,i=1,o=!1,r={init:function(){setRefreshHeight(),getTaskParams(r.footerSuccFun);var e=get_url_hash("startDate");void 0!=e&&(n=1),r.getTaskList(),r.pullRefresh()},filterEnsure:function(){e(".ensure").click(function(o){o.stopPropagation(),n=e(this).attr("data-type"),_id=e(this).attr("data-id"),"2"==n?t=_id:"3"==n&&(a=_id),i=1,e(".task-content .aui-list").children().remove(),r.getTaskList()})},getTaskList:function(){var o={type:n,page:i,page_size:pagesize};if("2"==n&&(o.task_type=t),"3"==n&&(o.stage_id=a),"1"==n){var s=get_url_hash("startDate"),c=get_url_hash("endDate"),l={start_time:s,end_time:c};o.timearea=l}var u=mergeInfo("a_task_list",o);ajaxFun(u,r.successFun,beforeLoadFun(e(".task-content .aui-list")))},pullRefresh:function(){var t=new auiPullToRefresh({container:document.querySelector(".aui-refresh-content"),triggerDistance:100},function(a){"success"==a.status&&setTimeout(function(){i=1,e(".task-content .aui-list").children().remove(),r.getTaskList(),t.cancelLoading()},1500)})},scrollAddMore:function(){new auiScroll({listen:!0,distance:0},function(t){t.isToBottom&&o&&e("body").scrollTop()>0&&(o=!1,i++,r.getTaskList())})},getTaskInfo:function(){e(".task-content .aui-list>li").bind("click",function(t){t.stopPropagation();var a=e(this).attr("data-t-id"),n={task_id:a},i=mergeInfo("get_task_examine_info",n);ajaxFun(i,r.successFun1,beforeDialogFun)})},successFun1:function(t){e(".zhezhao").remove();var a=decodeMsg(t);if(1==a.errcode){var n=e(".copy-dialog-content").clone(),i=a.data,o=i.title,r=i.content,s=(i.status,i.process),c=i.task_img,l=i.task_examine_explain;n.find(".task-name").text(o),n.find(".popup-task-content").text(r),"null"!=c&&(n.find(".task-img-content>img").attr("src",c),n.find(".task-img-item").removeAttr("style")),null!=l&&(n.find(".task-explain-content").text(l),n.find(".task-explain-item").removeAttr("style"));for(var u in s){var d=e(".item-copy").clone();d.find(".task-step").text(s[u].stage_name+"执行人："),d.find(".task-step-name").text(s[u].account_name);var f=e("<a />").attr("href","tel:"+s[u].mobile).text(s[u].mobile);d.find(".task-step-mob").append(f),n.find(".aui-list").append(d.html())}var g=new auiDialog;g.alert({title:"",msg:n.html(),buttons:["关闭"]},function(t){1==t.buttonIndex&&(g.remove(),e(".aui-mask-in").remove())}),null!=c&&e(".aui-dialog .task-img-content>img").fsgallery()}else alert(a.errmsg)},successFun:function(t){e(".loading-more").remove();var a=decodeMsg(t);if(1==a.errcode){var n=a.data.list;a.data.count;if(n.length){for(var i in n){var s=e(".copy-content").clone(!0);s.find("li").attr({"data-t-id":n[i].t_id,"data-stage-id":n[i].t_stage_id}),s.find(".aui-list-item-title").text(n[i].t_title),s.find(".task-date").text(n[i].create_time),s.find(".task-progress").text(n[i].stage_name),e(".task-content .aui-list").append(s.html())}o=!0,r.scrollAddMore(),r.getTaskInfo()}else{var c=createEmptyDom();e(".task-content .aui-list").append(c)}}else alert(a.errmsg)},filterPopEvt:function(){e(".item-filter .aui-popup-content").find(".aui-list-item").each(function(){var t=e(this).attr("data-type");if("filter-date"==t)e(this).click(function(t){t.stopPropagation(),popup.hide(document.getElementById("filter-type")),window.location.href=e(this).attr("data-url")});else if("filter-type"==t){new MobileSelect({trigger:".aui-list-item-inner."+t,title:"",wheels:[{data:typeList}]})}else if("filter-stage"==t){new MobileSelect({trigger:".aui-list-item-inner."+t,title:"",wheels:[{data:stageList}]})}}),r.filterEnsure()},footerSuccFun:function(e){var t=decodeMsg(e);1==t.errcode&&(stageList=t.data.stage,typeList=t.data.task_type,account_type=t.data.account_type,r.filterPopEvt())}};return{init:r.init}}(jQuery),DateSearch=function(e){var t=new auiToast,a={init:function(){e(".search-btn").bind("click",function(e){e.stopPropagation(),beforeDialogFun(),a.checkDateInfo()})},checkDateInfo:function(){var a=e("#startDate").text(),n=e("#endDate").text();return"请选择"==a?(e(".zhezhao").remove(),t.fail({title:"请选择开始时间",duration:5e3}),!1):"请选择"==n?(e(".zhezhao").remove(),t.fail({title:"请选择结束时间",duration:5e3}),!1):void setTimeout(function(){e(".zhezhao").remove(),window.location.href=searchUrl+"&startDate="+a+"&endDate="+n},1e3)}};return{init:a.init}}(jQuery),Newtask=function(e){var t,a,n=6,i=new auiDialog,o=new auiToast,r={init:function(){getTaskParams(r.taskParamsSucc),r.addStageStep(),r.createTask(),wxBasicInfo(r.wxSuccssFn)},createTask:function(){e(".publish-btn").on("click",function(t){t.stopPropagation();var n=e('input[name="taskname"]').val(),s=e(".select-task-type").attr("data-id"),c=e('textarea[name="tcontent"]').val();if(!n)return o.fail({title:"请输入任务名",duration:5e3}),!1;if(!s||void 0==s)return o.fail({title:"请选择任务类型",duration:5e3}),!1;if(!c)return o.fail({title:"请输入任务描述",duration:5e3}),!1;var l=r.getStageList();if(!l)return!1;var u={title:n,content:c,task_type:s,user_id:localStorage.user_id,process:l};void 0!=a&&(u.task_img=a),i.alert({title:"",msg:document.getElementById("dialog-inner-content").innerHTML,buttons:["确认","取消"]},function(t){if(1==t.buttonIndex){var a=mergeInfo("create_task",u);ajaxFun(a,r.successFun,beforeDialogFun)}else i.remove(),e(".aui-mask-in").remove()})})},wxSuccssFn:function(t){var n=decodeMsg(t);if(1==n.errcode){var i=n.data.signature;wx.config({debug:!1,appId:appid,timestamp:timestamp,nonceStr:nonceStr,signature:i,jsApiList:["chooseImage","uploadImage"]}),wx.ready(function(){e(".select-img").click(function(e){e.stopPropagation(),wx.chooseImage({success:function(e){var a=e.localIds;a.length>1?o.fail({title:"只能选择一张图片",duration:5e3}):t(a)}})});var t=function(t){var n=t.pop();wx.getLocalImgData({localId:n,success:function(t){var n=t.localData,i=navigator.userAgent,o=i.indexOf("Android")>-1||i.indexOf("Adr")>-1;if(o){var r=n;n="data:image/jgp;base64,"+r}a=n,e(".select-img").text("已选择").attr("data-status","1")}})}}),wx.error(function(e){alert(e.errMsg)})}},taskParamsSucc:function(a){var i=decodeMsg(a);if(1==i.errcode){stageList=i.data.stage,typeList=i.data.task_type,account_type=i.data.account_type;var o=(new MobileSelect({trigger:".select-task-type",title:"",wheels:[{data:typeList}]}),e(".copy-content")),s=0;for(var c in stageList){var l=e("<option />");l.val(c).text(stageList[c]),o.find(".s-step").append(l),s++}n=s;for(var u in account_type){var d=e("<option />");d.val(u).text(account_type[u]),o.find(".s-level").append(d)}t=e(".copy-content"),r.getAccount(o.find(".s-level").val())}},getAccount:function(e){var t={account_type:e},a=mergeInfo("get_accounts",t);ajaxFun(a,r.accountSucc,"")},selectLevelEvt:function(){e(".step-list .s-level").change(function(){var a=e(this).val();t=e(this).parents(".stage-item"),r.getAccount(a)})},accountSucc:function(a){var n=decodeMsg(a);if(1==n.errcode){var i=n.data;t.find(".s-user>option").remove();for(var o in i){var r=e("<option />");r.val(i[o].a_id).text(i[o].a_name),t.find(".s-user").append(r)}}},successFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?(i.remove(),e(".aui-mask-in").remove(),window.location.href=listUrl):alert(a.errmsg)},getStageList:function(){var t=e(".step-list").children();if(t.length){var a={};t.each(function(){var t=e(this).find(".s-step"),n=e(this).find(".s-level"),i=e(this).find(".s-user"),o={},r=t.val(),s=n.val(),c=i.val(),l=i.find("option:selected").text();o.a_id=c,o.a_name=l,o.a_type=s,a[r]=o});var n=0;for(var i in a)n++;return t.length>n?(alert("阶段不能重复，请重新选择"),!1):a}return alert("任务设置不能为空"),!1},addStageStep:function(){e(".add-stage-btn").bind("click",function(t){t.stopPropagation();var a=e(".step-list").children();if(a.length<n){var i=e(".copy-content").clone();e(".step-list").append(i.html()),r.removeStageStep(),r.selectLevelEvt()}else alert("已达到最大流程设置")})},removeStageStep:function(){e(".step-list .stage-rm-btn").click(function(t){t.stopPropagation(),e(this).parent().remove()})}};return{init:r.init}}(jQuery),Review=function(e){var t,a=new auiToast,n=new auiDialog,i=1,o=!1,r={init:function(){setRefreshHeight(),r.getReviewList(),r.pullRefresh()},getReviewInfo:function(){e(".review-content .aui-list>li").bind("click",function(a){a.stopPropagation(),t=e(this).attr("data-t-id");var n={task_id:t},i=mergeInfo("get_task_examine_info",n);ajaxFun(i,r.successFun1,beforeDialogFun)})},getReviewList:function(){var t={page:i,page_size:pagesize},a=mergeInfo("task_examine_list",t);ajaxFun(a,r.successFun,beforeLoadFun(e(".review-content .aui-list")))},updateStatus:function(e,a){var n={task_id:t,examine_explain:a,status:e},i=mergeInfo("update_task_status",n);ajaxFun(i,r.successFun2,beforeDialogFun)},successFun2:function(t){e(".zhezhao").remove();var i=decodeMsg(t);1==i.errcode?(a.success({title:"操作成功",duration:5e3}),n.remove(),e(".aui-mask-in").remove(),window.location.reload()):alert(i.errmsg)},successFun1:function(t){e(".zhezhao").remove();var a=decodeMsg(t);if(1==a.errcode){var i=e(".copy-dialog-content").clone(),o=a.data,s=o.title,c=o.content,l=o.status,u=o.process,d=o.task_img,f=o.task_examine_explain;i.find(".task-name").text(s),i.find(".popup-task-content").text(c),"null"!=d&&(i.find(".task-img-content>img").attr("src",d),i.find(".task-img-item").removeAttr("style")),null!=f&&(i.find(".task-explain-content").text(f),i.find(".task-explain-item").removeAttr("style"));for(var g in u){var p=e(".item-copy").clone();p.find(".task-step").text(u[g].stage_name+"执行人："),p.find(".task-step-name").text(u[g].account_name);var m=e("<a />").attr("href","tel:"+u[g].mobile).text(u[g].mobile);p.find(".task-step-mob").append(m),i.find(".task-explain-item").after(p.html())}6==l&&(i.find(".task-change-process").removeAttr("style"),getTaskParams(r.taskParamsSucc)),n.alert({title:"",msg:i.html(),buttons:["关闭","审核通过","审核不通过","同意中止","不同意中止","变更"]},function(t){var a=e(".aui-dialog #review-remark").val();if(!a&&1!=t.buttonIndex)return alert("请输入备注"),!1;var i,o=t.buttonIndex;3==o||5==o?i=1:2==o?i=4:4==o&&(i=5),1!=o?r.updateStatus(i,a):(n.remove(),e(".aui-mask-in").remove())}),"null"!=d&&e(".aui-dialog .task-img-content>img").fsgallery(),2==l?(e(".aui-dialog-footer .aui-dialog-btn[button-index=3]").hide(),e(".aui-dialog-footer .aui-dialog-btn[button-index=4]").hide(),e(".aui-dialog-footer .aui-dialog-btn[button-index=5]").hide()):3==l?(e(".aui-dialog-footer .aui-dialog-btn[button-index=1]").hide(),e(".aui-dialog-footer .aui-dialog-btn[button-index=2]").hide(),e(".aui-dialog-footer .aui-dialog-btn[button-index=5]").hide()):6==l?(e(".aui-dialog-footer .aui-dialog-btn[button-index=1]").hide(),e(".aui-dialog-footer .aui-dialog-btn[button-index=2]").hide(),e(".aui-dialog-footer .aui-dialog-btn[button-index=3]").hide(),e(".aui-dialog-footer .aui-dialog-btn[button-index=4]").hide()):(e(".aui-dialog .remark-item").hide(),e(".aui-dialog-footer .aui-dialog-btn").hide(),e(".aui-dialog-footer .aui-dialog-btn[button-index=0]").show()),e("body").click(function(t){t.stopPropagation();var a=t.target.className;a.indexOf("aui-mask-in")>=0&&(n.remove(),e(".aui-mask-in").remove())})}else alert(a.errmsg)},taskParamsSucc:function(t){var a=decodeMsg(t);if(console.log(a),1==a.errcode){var n=a.data.account_type;for(var i in n){var o=e("<option />");o.val(i).text(n[i]),e(".aui-dialog .task-level").append(o)}r.getAccount(e(".aui-dialog .task-level").val()),r.selectLevelEvt()}},getAccount:function(e){var t={account_type:e},a=mergeInfo("get_accounts",t);ajaxFun(a,r.accountSucc,"")},selectLevelEvt:function(){e(".aui-dialog .task-level").change(function(){var t=e(this).val();r.getAccount(t)})},accountSucc:function(t){var a=decodeMsg(t);if(1==a.errcode){var n=a.data;e(".aui-dialog .task-user>option").remove();for(var i in n){var o=e("<option />");o.val(n[i].a_id).text(n[i].a_name),e(".aui-dialog .task-user").append(o)}}},successFun:function(t){e(".loading-more").remove();var a=decodeMsg(t);if(1==a.errcode){var n=a.data.list;a.data.count;if(n.length){for(var i in n){var s=e(".copy-content").clone(!0);s.find("li").attr({"data-t-id":n[i].t_id}),s.find(".aui-list-item-title").text(n[i].t_title),s.find(".task-date").text(n[i].create_time),s.find(".task-progress").text(n[i].task_status),e(".review-content .aui-list").append(s.html())}o=!0,r.scrollAddMore(),r.getReviewInfo()}else{var c=createEmptyDom();e(".review-content .aui-list").append(c)}}else alert(a.errmsg)},pullRefresh:function(){var t=new auiPullToRefresh({container:document.querySelector(".aui-refresh-content"),triggerDistance:100},function(a){"success"==a.status&&setTimeout(function(){i=1,e(".review-content .aui-list").children().remove(),r.getReviewList(),t.cancelLoading()},1500)})},scrollAddMore:function(){new auiScroll({listen:!0,distance:0},function(t){t.isToBottom&&o&&e("body").scrollTop()>0&&(o=!1,i++,r.getReviewList())})}};return{init:r.init}}(jQuery),Specfooter=function(e){var t={init:function(){t.addActiveFun(),e("footer.aui-bar-tab>.aui-bar-tab-item").click(function(t){t.stopPropagation(),0!=e(this).index()&&(window.location.href=urlArr[e(this).index()])})},addActiveFun:function(){var t=e('input[name="footerActive"]').val();e("footer.aui-bar-tab>.aui-bar-tab-item").eq(t).addClass("aui-active")}};return{init:t.init}}(jQuery),Footer=function(e){var t={init:function(){t.addActiveFun(),e("footer.aui-bar-tab>.aui-bar-tab-item").click(function(t){return t.stopPropagation(),!e(this).hasClass("aui-active")&&void(window.location.href=urlArr[e(this).index()])})},addActiveFun:function(){var t=e('input[name="footerActive"]').val();e("footer.aui-bar-tab>.aui-bar-tab-item").eq(t).addClass("aui-active")}};return{init:t.init}}(jQuery),Employee=function(e){var t=1,a=1,n=!1,i={init:function(){setRefreshHeight(),i.getEmployeeList(),i.tabSelectEvt(),i.pullRefresh()},getReviewInfo:function(){e(".employee-content .aui-list>li").bind("click",function(t){t.stopPropagation();var a=e(this).attr("data-t-id");window.location.href=detailUrl+"&task_id="+a})},tabSelectEvt:function(){e("#footer").children(".aui-bar-tab-item").click(function(n){n.stopPropagation();var o=e(this).attr("data-id");e(this).hasClass("aui-active")||(e("#footer").children(".aui-bar-tab-item").removeClass("aui-active"),e(this).addClass("aui-active"),a=o,t=1,e(".employee-content .aui-list").children().remove(),i.getEmployeeList())})},getEmployeeList:function(){var n={type:a,account_id:localStorage.account_id,page:t,page_size:pagesize},o=mergeInfo("account_task_list",n);ajaxFun(o,i.successFun,beforeLoadFun(e(".employee-content .aui-list")))},successFun:function(t){e(".loading-more").remove();var a=decodeMsg(t);if(1==a.errcode){var o=a.data.list;a.data.count;if(o.length){for(var r in o){var s=e(".copy-content").clone(!0);s.find("li").attr({"data-t-id":o[r].task_id}),s.find(".aui-list-item-title").text(o[r].task_title),s.find(".task-date").text(o[r].create_time),s.find(".task-progress").text(o[r].stage),e(".employee-content .aui-list").append(s.html())}n=!0,i.scrollAddMore(),i.getReviewInfo()}else{var c=createEmptyDom();e(".employee-content .aui-list").append(c)}}else alert(a.errmsg)},pullRefresh:function(){var a=new auiPullToRefresh({container:document.querySelector(".aui-refresh-content"),triggerDistance:100},function(n){"success"==n.status&&setTimeout(function(){t=1,e(".employee-content .aui-list").children().remove(),i.getEmployeeList(),a.cancelLoading()},1500)})},scrollAddMore:function(){new auiScroll({listen:!0,distance:0},function(a){a.isToBottom&&n&&e("body").scrollTop()>0&&(n=!1,t++,i.getEmployeeList())})}};return{init:i.init}}(jQuery),Employeedetail=function(e){var t,a,n,i,o=new auiDialog,r=new auiToast,s=9,c=!1,l=[],u=[],d={init:function(){d.getDetailInfo()},getDetailInfo:function(){var e=get_url_hash("task_id"),t={task_id:e},a=mergeInfo("get_account_task_info",t);ajaxFun(a,d.successFun,beforeDialogFun)},successFun:function(o){e(".zhezhao").remove();var r=decodeMsg(o);if(1==r.errcode){var s=r.data.process_list,l=r.data.task_title,f=r.data.task_content,g=r.data.task_img,p=r.data.task_examine_plain;n=r.data.task_id,i=r.data.task_status,t=r.data.now_process_id,a=r.data.account_id,e(".task_title").text(l),e(".task_content").text(f),alert(g),"null"==g||g||(e(".task-info img").attr("src",g).fsgallery(),e(".task-info").removeClass("aui-hide")),null!=p&&(e(".task-explain-content").text(p),e(".task-explain").removeClass("aui-hide"));var m=0;for(var v in s){m++;var h;h=v%2==0?e(".copy-item-right").clone():e(".copy-item-left").clone(),h.find(".tree-item").css("top",50*v+"px"),h.find(".item-stage").text(s[v].stage_name),h.find(".item-user").text(s[v].account_name),h.find(".item-date").text(s[v].start_time?s[v].start_time:""),s[v].img[0]&&h.find(".item-img>img").attr({src:s[v].img[0],"data-index":v}),u.push(s[v].img),0==s[v].start_time&&h.find(".tree-item").addClass("completed"),e(".tree-list").append(h.html())}s[m-1].process_id==t&&(c=!0),d.imgDialogEvt(),d.tabDisplayEvt(),e(".tree-list").css("height",80*m+"px")}else alert(r.errmsg)},imgDialogEvt:function(){e(".tree-list .item-img>img").click(function(){if(void 0!=e(this).attr("data-index")){e("#task-img-dialog .img-popup-content").children().remove();var t=e(this).attr("data-index"),a=u[t];for(var n in a)if(a[n]){var i=e("<img />").attr("src",a[n]);e("#task-img-dialog .img-popup-content").append(i)}}else e("#task-img-dialog .img-popup-content").text("还未上传图片");o.alert({title:"",msg:document.getElementById("task-img-dialog").innerHTML,buttons:["关闭"]},function(t){1==t.buttonIndex&&(o.remove(),e(".aui-mask-in").remove())}),e(".aui-dialog-body .img-popup-content img").fsgallery()})},tabDisplayEvt:function(){1==i?(d.taskChange(),d.taskOver(),localStorage.account_id==a&&(e(".detail-footer>.aui-bar-tab-item").eq(0).css("display","table-cell"),e(".detail-footer>.aui-bar-tab-item").eq(2).css("display","table-cell"),e(".detail-footer>.aui-bar-tab-item").eq(3).css("display","table-cell"),d.addImgDialog(),c?(e(".detail-footer>.aui-bar-tab-item").eq(4).css("display","table-cell"),d.taskReview()):(e(".detail-footer>.aui-bar-tab-item").eq(1).css("display","table-cell"),d.taskTransfer()))):2==i?e(".detail-footer>.aui-bar-tab-item").eq(5).css("display","table-cell"):3==i?e(".detail-footer>.aui-bar-tab-item").eq(6).css("display","table-cell"):4==i?e(".detail-footer>.aui-bar-tab-item").eq(7).css("display","table-cell"):5==i?e(".detail-footer>.aui-bar-tab-item").eq(8).css("display","table-cell"):6==i&&e(".detail-footer>.aui-bar-tab-item").eq(9).css("display","table-cell")},wxSuccssFn:function(t){var a=decodeMsg(t);if(1==a.errcode){var n=a.data.signature;wx.config({debug:!1,appId:appid,timestamp:timestamp,nonceStr:nonceStr,signature:n,jsApiList:["chooseImage","uploadImage"]}),wx.ready(function(){e(".aui-dialog-body .chooseImgBtn").click(function(a){a.stopPropagation(),wx.chooseImage({success:function(a){var n=a.localIds,i=e(".aui-dialog-body .img-content").children().length;n.length>s||i+n.length>s+1?alert("最多上传9张图片"):t(n,0)}})});var t=function(a,n){var i=a.pop();wx.getLocalImgData({localId:i,success:function(i){var o=i.localData,r=navigator.userAgent,s=r.indexOf("Android")>-1||r.indexOf("Adr")>-1;if(s){var c=o;o="data:image/jgp;base64,"+c}var u=e("<img />").attr({src:o,"data-id":n}).on("click",function(t){t.stopPropagation(),d.changeImage(e(this))});l.push(o),e(".aui-dialog-body .img-content").append(u),a.length>0&&(n++,t(a,n))}})}}),wx.error(function(e){alert(e.errMsg)})}},changeImage:function(e){wx.ready(function(){wx.chooseImage({success:function(e){var a=e.localIds;a.length>1?r.fail({title:"只能选择一张图片",duration:5e3}):t(a)}});var t=function(t){var a=t.pop();wx.getLocalImgData({localId:a,success:function(t){var a=t.localData,n=navigator.userAgent,i=n.indexOf("Android")>-1||n.indexOf("Adr")>-1;if(i){var o=a;a="data:image/jgp;base64,"+o}e.attr("src",a);var r=e.attr("data-id");l.splice(r,1),l.push(a)}})}})},uploadImage:function(){if(l.length){var e={process_id:t,account_id:localStorage.account_id,imgcodes:l},a=mergeInfo("update_process_imgs",e);ajaxFun(a,d.uploadSuccessFn,beforeDialogFun)}else r.fail({title:"请先添加图片再上传",duration:5e3})},uploadSuccessFn:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?(r.success({title:"照片上传成功",duration:5e3}),window.location.reload()):alert(a.errmsg)},addImgDialog:function(){e(".task-img-btn").on("click",function(t){t.stopPropagation(),o.alert({title:"",msg:document.getElementById("img-dialog").innerHTML,buttons:["上传","关闭"]},function(t){1==t.buttonIndex?d.uploadImage():(o.remove(),l=[],e(".aui-mask-in").remove())}),wxBasicInfo(d.wxSuccssFn)})},taskTransfer:function(){e(".task-transfer-btn").on("click",function(a){a.stopPropagation(),o.alert({title:"",msg:document.getElementById("task-transfer-dialog").innerHTML,buttons:["确认","取消"]},function(a){if(1==a.buttonIndex){var i={process_id:t,task_id:n},r=mergeInfo("process_next",i);ajaxFun(r,d.successFun1,beforeDialogFun)}else o.remove(),e(".aui-mask-in").remove()})})},successFun1:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?(r.success({title:"流转提交成功",duration:5e3}),window.location.href=taskUrl):alert(a.errmsg)},taskChange:function(){e(".task-change-btn").on("click",function(a){a.stopPropagation(),o.alert({title:"",msg:document.getElementById("task-change-dialog").innerHTML,buttons:["提交","取消"]},function(a){if(1==a.buttonIndex){if(!e(".aui-dialog .change-content>textarea").val())return alert("请输入变更原因"),!1;var i={process_id:t,task_id:n,examine_content:e(".aui-dialog .change-content>textarea").val()},r=mergeInfo("change_process_account",i);ajaxFun(r,d.successFun2,beforeDialogFun)}else o.remove(),e(".aui-mask-in").remove()})})},successFun2:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?(r.success({title:"变更提交成功",duration:5e3}),window.location.reload()):alert(a.errmsg)},successFun3:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?(r.success({title:"中止提交成功",duration:5e3}),window.location.reload()):alert(a.errmsg)},successFun4:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?(r.success({title:"申请提交成功",duration:5e3}),window.location.reload()):alert(a.errmsg)},taskOver:function(){e(".task-over-btn").on("click",function(a){a.stopPropagation(),o.alert({title:"",msg:document.getElementById("task-over-dialog").innerHTML,buttons:["提交","取消"]},function(a){if(1==a.buttonIndex){if(!e(".aui-dialog .over-content>textarea").val())return r.fail({title:"请输入中止原因",duration:5e3}),!1;var i={process_id:t,task_id:n,examine_content:e(".aui-dialog .over-content>textarea").val(),type:2},s=mergeInfo("apply_examine_task",i);ajaxFun(s,d.successFun3,beforeDialogFun)}else o.remove(),e(".aui-mask-in").remove()})})},taskReview:function(){e(".task-review-btn").on("click",function(a){a.stopPropagation(),o.alert({title:"",msg:document.getElementById("task-review-dialog").innerHTML,buttons:["确认","取消"]},function(a){if(1==a.buttonIndex){if(!e(".aui-dialog .review-content>textarea").val())return r.fail({title:"请输入审核原因",duration:5e3}),!1;var i={process_id:t,task_id:n,examine_content:e(".aui-dialog .review-content>textarea").val(),type:1},s=mergeInfo("apply_examine_task",i);ajaxFun(s,d.successFun4,beforeDialogFun)}else o.remove(),e(".aui-mask-in").remove()})})}};return{init:d.init}}(jQuery),Answer=function(e){var t=1,a=!1,n={init:function(){setRefreshHeight(),n.getAnswerList(),n.pullRefresh()},pullRefresh:function(){var a=new auiPullToRefresh({container:document.querySelector(".aui-refresh-content"),triggerDistance:100},function(i){"success"==i.status&&setTimeout(function(){t=1,e(".answer-content .aui-list").children().remove(),n.getAnswerList(),a.cancelLoading()},1500)})},getAnswerInfo:function(){e(".answer-content .aui-list>li").bind("click",function(t){t.stopPropagation();var a=e(this).attr("data-a-id");window.location.href=detailUrl+"&answer_id="+a})},getAnswerList:function(){var a={user_type:"1",user_id:localStorage.wechat_member_id,page:t,page_size:pagesize},i=mergeInfo("get_consult_list",a);ajaxFun(i,n.successFun,beforeLoadFun(e(".answer-content .aui-list")))},successFun:function(t){e(".loading-more").remove();var i=decodeMsg(t);if(1==i.errcode){var o=i.data.list;i.data.count;if(o.length){for(var r in o){var s=e(".copy-content").clone(!0);s.find("li").attr({"data-a-id":o[r].consult_id}),s.find(".answer-title").text(o[r].consult_title),s.find(".answer-news").text(null==o[r].last_reply?"":o[r].last_reply),s.find(".answer-date").text(o[r].new_reply_time),s.find(".answer-status").text(o[r].consult_status),e(".answer-content .aui-list").append(s.html())}a=!0,n.scrollAddMore(),n.getAnswerInfo()}else{var c=createEmptyDom();e(".answer-content .aui-list").append(c)}}else alert(i.errmsg)},scrollAddMore:function(){new auiScroll({listen:!0,distance:0},function(i){i.isToBottom&&a&&e("body").scrollTop()>0&&(a=!1,t++,n.getAnswerList())})}};return{init:n.init}}(jQuery),AnswerFooter=function(e){var t={init:function(){e("footer.aui-bar-tab>.aui-bar-tab-item").click(function(e){e.stopPropagation(),window.location.href=url})}};return{init:t.init}}(jQuery),AddAnswer=function(e){var t=new auiDialog,a=new auiToast,n={init:function(){getAnswerType(n.consultationParamsSucc),n.explainPopup(),n.submitEvt()},submitEvt:function(){e("footer.aui-bar-tab>.aui-bar-tab-item").click(function(t){t.stopPropagation();var i=e('input[name="consultationName"]').val(),o=e(".select-consultation-type").attr("data-id"),r=e('textarea[name="tcontent"]').val();if(!i)return a.fail({title:"请输入咨询标题",duration:3e3}),!1;if(!o||void 0==o)return a.fail({title:"请选择咨询类型",duration:3e3}),!1;if(!r)return a.fail({title:"请输入咨询内容",duration:3e3}),!1;var s={consult_title:i,consult_content:r,consult_type:o,member_id:localStorage.wechat_member_id},c=mergeInfo("create_consult_task",s);ajaxFun(c,n.successFun,beforeDialogFun)})},successFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?(e(".aui-mask-in").remove(),window.location.href=listUrl):alert(a.errmsg)},consultationParamsSucc:function(e){var t=decodeMsg(e);if(1==t.errcode){var a=t.data.expert_type;new MobileSelect({trigger:".select-consultation-type",title:"",wheels:[{data:a}]})}},explainPopup:function(){e(".aui-icon-question").on("click",function(a){a.stopPropagation(),t.alert({title:"",msg:document.getElementById("dialog-inner-content").innerHTML,buttons:["关闭"]},function(a){1==a.buttonIndex&&(t.remove(),e(".aui-mask-in").remove())})})}};return{init:n.init}}(jQuery),AnswerDetail=function(e){var t=new auiDialog,a=new auiToast,n=get_url_hash("answer_id"),i=1,o=5,r=!1,s={init:function(){s.getDetailInfo()},getDetailInfo:function(){var e={consult_id:n},t=mergeInfo("get_consult_info",e);ajaxFun(t,s.successFun,beforeDialogFun)},successFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t);if(1==a.errcode){var n=a.data.consult_title,i=a.data.consult_content;e(".answer-detail-title").text(n),e(".task_content").text(i),3==a.data.consult_status?e(".answer-footer").text("已结束").addClass("over"):(s.consultReply(),s.consultEnd()),s.getReplyList()}else alert(a.errmsg)},getReplyList:function(){var t={consult_id:n,page:i,page_size:o},a=mergeInfo("get_reply_list",t);ajaxFun(a,s.listSuccessFun,beforeLoadFun(e("#message-content")))},listSuccessFun:function(t){e(".loading-more").remove();var a=decodeMsg(t);if(1==a.errcode){var n=a.data.list;a.data.count;if(n.length){for(var i in n){var o;1==n[i].replyer_type?o=e(".copy-item-left").clone(!0):2==n[i].replyer_type&&(o=e(".copy-item-right").clone(!0)),o.find("img").attr("src",n[i].head_img),o.find(".wx-name").text(n[i].nick_name),o.find(".wx-date").text(n[i].reply_time),o.find(".wx-content").text(n[i].reply_content),e("#message-content").append(o.html())}r=!0,s.scrollAddMore()}else{var c=e("<div />").addClass("empty"),l=e("<span />").text("暂无互动信息");c.append(l),e("#message-content").append(c)}}else alert(a.errmsg)},scrollAddMore:function(){new auiScroll({listen:!0,distance:0},function(t){t.isToBottom&&r&&e("body").scrollTop()>0&&(r=!1,i++,s.getReplyList())})},consultReply:function(){e(".add-btn").bind("click",function(t){t.stopPropagation();var i=e(".answer-footer textarea").val();if(!i)return a.fail({title:"请输入咨询内容",duration:3e3}),!1;var o={consult_id:n,replyer_id:localStorage.wechat_member_id,replyer_type:"1",reply_content:i},r=mergeInfo("consult_reply",o);ajaxFun(r,s.replySuccessFun,beforeDialogFun)})},replySuccessFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?window.location.reload():alert(a.errmsg)},consultEnd:function(){e(".over-btn").bind("click",function(a){a.stopPropagation(),t.alert({title:"",
msg:document.getElementById("dialog-inner-content").innerHTML,buttons:["确认","取消"]},function(a){if(1==a.buttonIndex){var i={consult_id:n},o=mergeInfo("end_consult",i);ajaxFun(o,s.endSuccessFun,beforeDialogFun)}else t.remove(),e(".aui-mask-in").remove()})})},endSuccessFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?window.location.reload():alert(a.errmsg)}};return{init:s.init}}(jQuery),Expert=function(e){var t=1,a=!1,n={init:function(){var t=window.screen.height;e(".aui-refresh-content").css("min-height",t+"px"),n.getAnswerList(),n.pullRefresh()},pullRefresh:function(){var a=new auiPullToRefresh({container:document.querySelector(".aui-refresh-content"),triggerDistance:100},function(i){"success"==i.status&&setTimeout(function(){t=1,e(".answer-content .aui-list").children().remove(),n.getAnswerList(),a.cancelLoading()},1500)})},getAnswerInfo:function(){e(".answer-content .aui-list>li").bind("click",function(t){t.stopPropagation();var a=e(this).attr("data-a-id");window.location.href=detailUrl+"&answer_id="+a})},getAnswerList:function(){var a={user_type:"2",user_id:localStorage.account_id,page:t,page_size:pagesize},i=mergeInfo("get_consult_list",a);ajaxFun(i,n.successFun,beforeLoadFun(e(".answer-content .aui-list")))},successFun:function(t){e(".loading-more").remove();var i=decodeMsg(t);if(1==i.errcode){var o=i.data.list;i.data.count;if(o.length){for(var r in o){var s=e(".copy-content").clone(!0);s.find("li").attr({"data-a-id":o[r].consult_id}),s.find(".answer-title").text(o[r].consult_title),s.find(".answer-news").text(null==o[r].last_reply?"":o[r].last_reply),s.find(".answer-date").text(o[r].new_reply_time),s.find(".answer-status").text(o[r].consult_status),e(".answer-content .aui-list").append(s.html())}a=!0,n.scrollAddMore(),n.getAnswerInfo()}else{var c=createEmptyDom();e(".answer-content .aui-list").append(c)}}else alert(i.errmsg)},scrollAddMore:function(){new auiScroll({listen:!0,distance:0},function(i){i.isToBottom&&a&&e("body").scrollTop()>0&&(a=!1,t++,n.getAnswerList())})}};return{init:n.init}}(jQuery),ExpertDetail=function(e){var t=new auiToast,a=get_url_hash("answer_id"),n=1,i=5,o=!1,r={init:function(){r.getDetailInfo()},getDetailInfo:function(){var e={consult_id:a},t=mergeInfo("get_consult_info",e);ajaxFun(t,r.successFun,beforeDialogFun)},successFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t);if(1==a.errcode){var n=a.data.consult_title,i=a.data.consult_content;e(".answer-detail-title").text(n),e(".task_content").text(i),3==a.data.consult_status?e(".answer-footer").text("已结束").addClass("over"):r.consultReply(),r.getReplyList()}else alert(a.errmsg)},getReplyList:function(){var t={consult_id:a,page:n,page_size:i},o=mergeInfo("get_reply_list",t);ajaxFun(o,r.listSuccessFun,beforeLoadFun(e("#message-content")))},listSuccessFun:function(t){e(".loading-more").remove();var a=decodeMsg(t);if(1==a.errcode){var n=a.data.list;a.data.count;if(n.length){for(var i in n){var s;1==n[i].replyer_type?s=e(".copy-item-left").clone(!0):2==n[i].replyer_type&&(s=e(".copy-item-right").clone(!0)),s.find("img").attr("src",n[i].head_img),s.find(".wx-name").text(n[i].nick_name),s.find(".wx-date").text(n[i].reply_time),s.find(".wx-content").text(n[i].reply_content),e("#message-content").append(s.html())}o=!0,r.scrollAddMore()}else{var c=e("<div />").addClass("empty"),l=e("<span />").text("暂无互动信息");c.append(l),e("#message-content").append(c)}}else alert(a.errmsg)},scrollAddMore:function(){new auiScroll({listen:!0,distance:0},function(t){t.isToBottom&&o&&e("body").scrollTop()>0&&(o=!1,n++,r.getReplyList())})},consultReply:function(){e(".add-btn").bind("click",function(n){n.stopPropagation();var i=e(".answer-footer textarea").val();if(!i)return t.fail({title:"请输入回复内容",duration:3e3}),!1;var o={consult_id:a,replyer_id:localStorage.account_id,replyer_type:"2",reply_content:i},s=mergeInfo("consult_reply",o);ajaxFun(s,r.replySuccessFun,beforeDialogFun)})},replySuccessFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t);1==a.errcode?window.location.reload():alert(a.errmsg)}};return{init:r.init}}(jQuery),AdminExpert=function(e){var t=1,a=!1,n={init:function(){setRefreshHeight(),n.getAnswerList(),n.pullRefresh()},pullRefresh:function(){var a=new auiPullToRefresh({container:document.querySelector(".aui-refresh-content"),triggerDistance:100},function(i){"success"==i.status&&setTimeout(function(){t=1,e(".answer-content .aui-list").children().remove(),n.getAnswerList(),a.cancelLoading()},1500)})},getAnswerInfo:function(){e(".answer-content .aui-list>li").bind("click",function(t){t.stopPropagation();var a=e(this).attr("data-a-id");window.location.href=detailUrl+"&answer_id="+a})},getAnswerList:function(){var a={user_type:"3",user_id:localStorage.user_id,page:t,page_size:pagesize},i=mergeInfo("get_consult_list",a);ajaxFun(i,n.successFun,beforeLoadFun(e(".answer-content .aui-list")))},successFun:function(t){e(".loading-more").remove();var i=decodeMsg(t);if(1==i.errcode){var o=i.data.list;i.data.count;if(o.length){for(var r in o){var s=e(".copy-content").clone(!0);s.find("li").attr({"data-a-id":o[r].consult_id}),s.find(".answer-title").text(o[r].consult_title),s.find(".answer-news").text(null==o[r].last_reply?"":o[r].last_reply),s.find(".answer-date").text(o[r].new_reply_time),s.find(".answer-status").text(o[r].consult_status),e(".answer-content .aui-list").append(s.html())}a=!0,n.scrollAddMore(),n.getAnswerInfo()}else{var c=createEmptyDom();e(".answer-content .aui-list").append(c)}}else alert(i.errmsg)},scrollAddMore:function(){new auiScroll({listen:!0,distance:0},function(i){i.isToBottom&&a&&e("body").scrollTop()>0&&(a=!1,t++,n.getAnswerList())})}};return{init:n.init}}(jQuery),AdminExpertDetail=function(e){var t=new auiToast,a=get_url_hash("answer_id"),n=1,i=5,o=!1,r={init:function(){r.getDetailInfo()},getExpertType:function(e){var t={expert_type:e},a=mergeInfo("get_expert_account",t);ajaxFun(a,r.expertParamsSucc,"")},expertParamsSucc:function(e){var t=decodeMsg(e);if(1==t.errcode){var a=t.data;if(a.length){new MobileSelect({trigger:".select-expert-type",title:"",wheels:[{data:a}]})}}},getDetailInfo:function(){var e={consult_id:a},t=mergeInfo("get_consult_info",e);ajaxFun(t,r.successFun,beforeDialogFun)},successFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t);if(1==a.errcode){var n=a.data.consult_title,i=a.data.consult_content;e(".answer-detail-title").text(n),e(".task_content").text(i),1!=a.data.consult_status?(e(".expert-type-inner, .expert-list-inner").removeClass("aui-list-item-arrow"),e(".select-expert-list").text(a.data.expert_type),e(".select-expert-type").text(a.data.consult_expert_name),e(".fp-btn").text("")):(getAnswerType(r.eParamsSucc),r.consultReply()),r.getReplyList()}else alert(a.errmsg)},eParamsSucc:function(e){var t=decodeMsg(e);if(1==t.errcode){var a=t.data.expert_type;new MobileSelect({trigger:".select-expert-list",title:"",wheels:[{data:a}]})}r.ensureEvt()},ensureEvt:function(){e(".wheels.select-expert-list").parents(".mobileSelect").find(".ensure ").click(function(){var t=e(".select-expert-list").attr("data-id");r.getExpertType(t)})},getReplyList:function(){var t={consult_id:a,page:n,page_size:i},o=mergeInfo("get_reply_list",t);ajaxFun(o,r.listSuccessFun,beforeLoadFun(e("#message-content")))},listSuccessFun:function(t){e(".loading-more").remove();var a=decodeMsg(t);if(1==a.errcode){var n=a.data.list;a.data.count;if(n.length){for(var i in n){var s;1==n[i].replyer_type?s=e(".copy-item-left").clone(!0):2==n[i].replyer_type&&(s=e(".copy-item-right").clone(!0)),s.find("img").attr("src",n[i].head_img),s.find(".wx-name").text(n[i].nick_name),s.find(".wx-date").text(n[i].reply_time),s.find(".wx-content").text(n[i].reply_content),e("#message-content").append(s.html())}o=!0,r.scrollAddMore()}else{var c=e("<div />").addClass("empty"),l=e("<span />").text("暂无互动信息");c.append(l),e("#message-content").append(c)}}else alert(a.errmsg)},scrollAddMore:function(){new auiScroll({listen:!0,distance:0},function(t){t.isToBottom&&o&&e("body").scrollTop()>0&&(o=!1,n++,r.getReplyList())})},consultReply:function(){e(".fp-btn").bind("click",function(n){if(n.stopPropagation(),void 0==e(".select-expert-list").attr("data-id"))return t.fail({title:"请选择专家类型",duration:3e3}),!1;if(void 0==e(".select-expert-type").attr("data-id"))return t.fail({title:"请选择分配专家",duration:3e3}),!1;var i={consult_id:a,expert_id:e(".select-expert-type").attr("data-id")},o=mergeInfo("allocation_expert",i);ajaxFun(o,r.replySuccessFun,beforeDialogFun)})},replySuccessFun:function(a){e(".zhezhao").remove();var n=decodeMsg(a);1==n.errcode?(t.success({title:"分配成功",duration:2e3}),setTimeout(function(){window.location.reload()},2e3)):alert(n.errmsg)}};return{init:r.init}}(jQuery),Employeelogin=function(e){var t=new auiToast,a={init:function(){window.localStorage.setItem("localStorage_url",e(".localStorage-url").val()),a.checkUserInfo(),a.getVerCode()},checkUserInfo:function(){e(".next-btn").bind("click",function(n){n.stopPropagation();var i=e(".mob").val(),o=e(".verify").val(),r=/^1[3|7|5|8]\d{9}$/;if(!r.test(i))return t.fail({title:"请输入手机号",duration:3e3}),e(".mob").focus(),!1;if(""==o)return t.fail({title:"请输入验证码",duration:3e3}),e(".verify").focus(),!1;if(o.length<6)return t.fail({title:"验证码格式不正确",duration:3e3}),e(".verify").focus(),!1;var s={wechat_openid:e(".openid").val(),mobile:i,type:type,sns_code:o},c=mergeInfo("bind_account",s);ajaxFun(c,a.successFun,beforeDialogFun)})},successFun:function(t){e(".zhezhao").remove();var a=decodeMsg(t),n="";if(1==a.errcode){var i=a.data.account_id,o=a.data.wechat_member_id;void 0!=i&&window.localStorage.setItem("account_id",i),void 0!=o&&window.localStorage.setItem("wechat_member_id",o),window.localStorage.setItem("account_name",a.data.account_name),window.localStorage.setItem("account_type",a.data.account_type),n="&status=success"}else n="&status=fail";window.location.href=nextUrl+n+"&type="+type},getVerCode:function(){e(".get-verify-btn").bind("click",function(a){a.stopPropagation();var n=e(this),i=e(".mob").val(),o=/^1[3|7|5|8]\d{9}$/;if(!o.test(i))return t.fail({title:"请输入正确的手机号",duration:3e3}),e(".mob").focus(),!1;var r={mobile:i},s=mergeInfo("send_seccode",r);e.ajax({type:"POST",url:apiUrl,data:s,dataType:"html",contentType:"application/json; charset=utf-8",beforeSend:function(){n.attr("disabled",!0)},success:function(e){var a=decodeMsg(e);if(1==a.errcode){n.css("background-color","#ccc");var i=new Date;i.setSeconds(i.getSeconds()+59);var o=i.getMonth()+1,r=i.getFullYear()+"-"+o+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds(),s=new Date(Date.parse(r.replace(/-/g,"/"))).getTime(),c=(s-(new Date).getTime())/1e3,l=setInterval(function(){if(c>1){c-=1;var e=Math.floor(c/3600/24),t=Math.floor(c/3600%24),a=Math.floor(c/60%60),i=Math.floor(c%60),o="";e>0&&(o+=e+"天"),t>0&&(t<10&&(t="0"+t),o+=t+"小时"),a>0&&(a<10&&(a="0"+a),o+=a+"分"),i>0&&(i<10&&(i="0"+i),o+=i+"秒"),n.text(o)}else clearInterval(l),n.attr("disabled",!1),n.text("重新获取验证码"),n.css("background-color","#00bcd4")},1e3)}else t.fail({title:"获取验证码失败",duration:2e3}),n.attr("disabled",!1)},error:function(e){console.log("error:"+e),n.attr("disabled",!1)}})})}};return{init:a.init}}(jQuery),VerifyEmployee=function(e){var t={init:function(){var t=get_url_hash("status"),a=get_url_hash("type");if("fans"==a)e(".outer-content").removeClass("aui-hide"),"success"==t?(e(".outer-content").find(".verify-success").show(),e(".outer-content .go-btn").bind("click",function(e){e.stopPropagation(),window.location.href=outTaskUrl})):"fail"==t&&e(".outer-content").find(".verify-error").show();else if(e(".inner-content").removeClass("aui-hide"),"success"==t){var n;e(".inner-content .user-name").text(localStorage.account_name),"expert"==a?e(".inner-content .stage-lebel").text(""):e(".inner-content .stage-lebel").text(localStorage.account_type),e(".inner-content .verify-success").show(),n="account"==a?taskUrl:expertUrl,e(".inner-content .go-btn").bind("click",function(e){e.stopPropagation(),window.location.href=n})}else"fail"==t&&e(".inner-content .verify-error").show()}};return{init:t.init}}(jQuery);
//# sourceMappingURL=common.js.map
